package me.dueris.genesismc.core.factory.powers.entity.damage;

import me.dueris.genesismc.core.entity.OriginPlayer;
import me.dueris.genesismc.core.factory.powers.armour.RestrictArmor;
import me.dueris.genesismc.core.utils.OriginContainer;
import org.bukkit.Material;
import org.bukkit.entity.EntityType;
import org.bukkit.entity.FallingBlock;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityDamageByEntityEvent;
import org.bukkit.event.entity.EntityDamageEvent;

import static me.dueris.genesismc.core.factory.powers.Powers.dmg_invulnerable;

public class InvulnerabilityDamage implements Listener {
    @EventHandler
    public void DamageEvent(EntityDamageEvent e){
        if(e.getEntity() instanceof Player){
            Player p = (Player) e.getEntity();
            if(dmg_invulnerable.contains(p)){
                for (OriginContainer origin : OriginPlayer.getOrigin(p).values()) {
                    if(origin.getPowerFileFromType("origins:invulnerability") != null){
                        String type = origin.getPowerFileFromType("origins:invulnerability").getDamageCondition().get("type").toString();

                        if(type.equalsIgnoreCase("origins:amount")){
                            String comparison = origin.getPowerFileFromType("origins:invulnerability").getDamageCondition().get("comparison").toString();
                            int compare_to = (int) origin.getPowerFileFromType("origins:invulnerability").getDamageCondition().get("compare_to");

                            if(RestrictArmor.compareValues(e.getDamage(), comparison, compare_to)){
                                e.setCancelled(true);
                                e.setDamage(0);
                            }

                        }

                        if(type.equalsIgnoreCase("origins:attacker")){
                            String entity_con_type = origin.getPowerFileFromType("origins:invulnerability").getEntityConditionFromDamageCondition().get("type").toString();
                            String entity_type = origin.getPowerFileFromType("origins:invulnerability").getEntityConditionFromDamageCondition().get("entity_type").toString();
                            //tell dueris to make entity conditions
                        }

                        if(type.equalsIgnoreCase("origins:bypasses_armor")){
                            if(e.isApplicable(EntityDamageEvent.DamageModifier.ARMOR)){
                                e.setCancelled(true);
                                e.setDamage(0);
                            }

                        }

                        if(type.equalsIgnoreCase("origins:explosive")){
                            if(e.getCause().equals(EntityDamageEvent.DamageCause.BLOCK_EXPLOSION) || e.getCause().equals(EntityDamageEvent.DamageCause.ENTITY_EXPLOSION)){
                                e.setCancelled(true);
                                e.setDamage(0);
                            }
                        }

                        if(type.equalsIgnoreCase("origins:fire")){
                            if(e.getCause().equals(EntityDamageEvent.DamageCause.FIRE)){
                                e.setCancelled(true);
                                e.setDamage(0);
                            }
                        }

                        if(type.equalsIgnoreCase("origins:from_falling")){
                            if(e.getCause().equals(EntityDamageEvent.DamageCause.FALL)){
                                e.setCancelled(true);
                                e.setDamage(0);
                            }
                        }

                        if(type.equalsIgnoreCase("origins:in_tag")){
                            String tag = origin.getPowerFileFromType("origins:invulnerability").getDamageCondition().get("tag").toString();
                            //need to parse tag folder
                        }

                        if(type.equalsIgnoreCase("origins:name")){
                            String name = origin.getPowerFileFromType("origins:invulnerability").getDamageCondition().get("name").toString();
                            if(name.equalsIgnoreCase("anvil")){
                                if(e.getCause().name().equalsIgnoreCase(name)){
                                    e.setCancelled(true);
                                    e.setDamage(0);
                                }
                            }
                        }

                        if(type.equalsIgnoreCase("origins:out_of_world")){

                        }

                        if(type.equalsIgnoreCase("origins:projectile")){

                        }

                        if(type.equalsIgnoreCase("origins:unblockable")){

                        }

                    }
                }
            }
        }
    }
}
